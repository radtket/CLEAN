/*
* jQuery Background video plugin for jQuery
* ---
* Copyright 2011, Victor Coulon (http://victorcoulon.fr)
* Released under the MIT, BSD, and GPL Licenses.
* based on jQuery Plugin Boilerplate 1.3
*/
(function($) {
    $.backgroundVideo = function(el, options) {
        var defaults = {
            videoid: "video_background",
            autoplay: true,
            loop: true,
            preload: true
        };
        var plugin = this;
        plugin.settings = {};
        var init = function() {
            plugin.settings = $.extend({}, defaults, options);
            plugin.el = el;
            buildVideo();
        };
        var buildVideo = function() {
            var html = "", preloadString = "", autoplayString = "", loopString = "", _preload = plugin.settings.preload, _autoplay = plugin.settings.autoplay, _loop = plugin.settings.loop;
            if (_preload) {
                preloadString = 'preload="auto"';
            } else {
                preloadString = "";
            }
            if (_autoplay) {
                autoplayString = 'autoplay="autoplay"';
            } else {
                autoplayString = "";
            }
            if (_loop) {
                loopString = 'loop="true"';
            } else {
                loopString = "";
            }
            html += '<video id="' + plugin.settings.videoid + '"' + preloadString + autoplayString + loopString;
            if (plugin.settings.poster) {
                html += ' poster="' + plugin.settings.poster + '" ';
            }
            html += 'style="display:none;position:fixed;top:0;left:0;bottom:0;right:0;z-index:-100;width:100%;height:100%;">';
            for (var i = 0; i < plugin.settings.types.length; i++) {
                html += '<source src="' + plugin.settings.path + plugin.settings.filename + "." + plugin.settings.types[i] + '" type="video/' + plugin.settings.types[i] + '" />';
            }
            html += "bgvideo</video>";
            plugin.el.html(html);
            plugin.videoEl = document.getElementById(plugin.settings.videoid);
            plugin.$videoEl = $(plugin.videoEl);
            plugin.$videoEl.fadeIn(2e3);
            setProportion();
        };
        var setProportion = function() {
            var proportion = getProportion();
            plugin.$videoEl.width(proportion * plugin.settings.width);
            plugin.$videoEl.height(proportion * plugin.settings.height);
            if (typeof plugin.settings.align !== "undefined") {
                centerVideo();
            }
        };
        var getProportion = function() {
            var windowWidth = $(window).width();
            var windowHeight = $(window).height();
            var windowProportion = windowWidth / windowHeight;
            var origProportion = plugin.settings.width / plugin.settings.height;
            var proportion = windowHeight / plugin.settings.height;
            if (windowProportion >= origProportion) {
                proportion = windowWidth / plugin.settings.width;
            }
            return proportion;
        };
        var centerVideo = function() {
            var centerX = ($(window).width() >> 1) - (plugin.$videoEl.width() >> 1) | 0;
            var centerY = ($(window).height() >> 1) - (plugin.$videoEl.height() >> 1) | 0;
            if (plugin.settings.align == "centerXY") {
                plugin.$videoEl.css({
                    left: centerX,
                    top: centerY
                });
                return;
            }
            if (plugin.settings.align == "centerX") {
                plugin.$videoEl.css("left", centerX);
                return;
            }
            if (plugin.settings.align == "centerY") {
                plugin.$videoEl.css("top", centerY);
                return;
            }
        };
        init();
        $(window).resize(function() {
            setProportion();
        });
        plugin.$videoEl.bind("ended", function() {
            this.play();
        });
    };
})(jQuery);

(function($) {
    "use strict";
    // Start of use strict
    $(window).trigger("scroll");
    $(window).trigger("resize");
    $(document).ready(function() {
        $(window).trigger("resize");
        init_fullscreen_menu();
        /*    if (!$("html").hasClass("mobile")) {*/
        var videobackground_1 = new $.backgroundVideo($("#video-background-1"), {
            align: "centerXY",
            width: 1280,
            height: 720,
            path: "video/",
            filename: "LastNightOut",
            /*        filename: "video-restaurant",*/
            types: [ "mp4", "ogg", "webm" ],
            autoplay: true,
            loop: true
        });
        /*    }*/
        if (!$("html").hasClass("mobile")) {
            var videobackground_1 = new $.backgroundVideo($("#video-background-1"), {
                align: "centerXY",
                width: 1280,
                height: 720,
                path: "video/",
                filename: "LastNightOut",
                types: [ "mp4", "ogg", "webm" ],
                autoplay: true,
                loop: true
            });
        }
    });
    $(window).resize(function() {
        js_height_init();
    });
    /* ---------------------------------------------
    Height 100%
    --------------------------------------------- */
    function js_height_init() {
        (function($) {
            $(".js-height-full").height($(window).height());
            $(".js-height-parent").each(function() {
                $(this).height($(this).parent().first().height());
            });
        })(jQuery);
    }
    /* ---------------------------------------------
     Fullscreen menu
   --------------------------------------------- */
    var fm_menu_wrap = $("#fullscreen-menu");
    var fm_menu_button = $(".fm-button");
    function init_fullscreen_menu() {
        fm_menu_button.click(function() {
            if ($(this).hasClass("animation-process")) {
                return false;
            } else {
                if ($(this).hasClass("active")) {
                    $(this).removeClass("active").css("z-index", "2001").addClass("animation-process");
                    fm_menu_wrap.find(".fm-wrapper-sub").fadeOut("fast", function() {
                        fm_menu_wrap.fadeOut(function() {
                            fm_menu_wrap.find(".fm-wrapper-sub").removeClass("js-active").show();
                            fm_menu_button.css("z-index", "1030").removeClass("animation-process");
                        });
                    });
                } else {
                    $(this).addClass("active").css("z-index", "2001").addClass("animation-process");
                    fm_menu_wrap.fadeIn(function() {
                        fm_menu_wrap.find(".fm-wrapper-sub").addClass("js-active");
                        fm_menu_button.removeClass("animation-process");
                    });
                }
                return false;
            }
        });
        $("#fullscreen-menu").find("a:not(.fm-has-sub)").click(function() {
            if (fm_menu_button.hasClass("animation-process")) {
                return false;
            } else {
                fm_menu_button.removeClass("active").css("z-index", "2001").addClass("animation-process");
                fm_menu_wrap.find(".fm-wrapper-sub").fadeOut("fast", function() {
                    fm_menu_wrap.fadeOut(function() {
                        fm_menu_wrap.find(".fm-wrapper-sub").removeClass("js-active").show();
                        fm_menu_button.css("z-index", "1030").removeClass("animation-process");
                    });
                });
            }
        });
        // Sub menu
        var fmHasSub = $(".fm-has-sub");
        var fmThisLi;
        fmHasSub.click(function() {
            fmThisLi = $(this).parent("li:first");
            if (fmThisLi.hasClass("js-opened")) {
                fmThisLi.find(".fm-sub:first").slideUp(function() {
                    fmThisLi.removeClass("js-opened");
                    fmThisLi.find(".fm-has-sub").find(".fa:first").removeClass("fa-angle-up").addClass("fa-angle-down");
                });
            } else {
                $(this).find(".fa:first").removeClass("fa-angle-down").addClass("fa-angle-up");
                fmThisLi.addClass("js-opened");
                fmThisLi.find(".fm-sub:first").slideDown();
            }
            return false;
        });
    }
})(jQuery);